{"version":3,"file":"animation-controls.mjs","sources":["../../../../src/animation/hooks/animation-controls.ts"],"sourcesContent":["import {\n    animateVisualElement,\n    setTarget,\n    type AnimationDefinition,\n    type LegacyAnimationControls,\n    type VisualElement,\n} from \"motion-dom\"\nimport { invariant } from \"motion-utils\"\n\nfunction stopAnimation(visualElement: VisualElement) {\n    visualElement.values.forEach((value) => value.stop())\n}\n\nfunction setVariants(visualElement: VisualElement, variantLabels: string[]) {\n    const reversedLabels = [...variantLabels].reverse()\n\n    reversedLabels.forEach((key) => {\n        const variant = visualElement.getVariant(key)\n        variant && setTarget(visualElement, variant)\n\n        if (visualElement.variantChildren) {\n            visualElement.variantChildren.forEach((child) => {\n                setVariants(child, variantLabels)\n            })\n        }\n    })\n}\n\nexport function setValues(\n    visualElement: VisualElement,\n    definition: AnimationDefinition\n) {\n    if (Array.isArray(definition)) {\n        return setVariants(visualElement, definition)\n    } else if (typeof definition === \"string\") {\n        return setVariants(visualElement, [definition])\n    } else {\n        setTarget(visualElement, definition as any)\n    }\n}\n\n/**\n * @public\n */\nexport function animationControls(): LegacyAnimationControls {\n    /**\n     * Track whether the host component has mounted.\n     */\n    let hasMounted = false\n\n    /**\n     * A collection of linked component animation controls.\n     */\n    const subscribers = new Set<VisualElement>()\n\n    const controls: LegacyAnimationControls = {\n        subscribe(visualElement) {\n            subscribers.add(visualElement)\n            return () => void subscribers.delete(visualElement)\n        },\n\n        start(definition, transitionOverride) {\n            invariant(\n                hasMounted,\n                \"controls.start() should only be called after a component has mounted. Consider calling within a useEffect hook.\"\n            )\n\n            const animations: Array<Promise<any>> = []\n            subscribers.forEach((visualElement) => {\n                animations.push(\n                    animateVisualElement(visualElement, definition, {\n                        transitionOverride,\n                    })\n                )\n            })\n\n            return Promise.all(animations)\n        },\n\n        set(definition) {\n            invariant(\n                hasMounted,\n                \"controls.set() should only be called after a component has mounted. Consider calling within a useEffect hook.\"\n            )\n\n            return subscribers.forEach((visualElement) => {\n                setValues(visualElement, definition)\n            })\n        },\n\n        stop() {\n            subscribers.forEach((visualElement) => {\n                stopAnimation(visualElement)\n            })\n        },\n\n        mount() {\n            hasMounted = true\n\n            return () => {\n                hasMounted = false\n                controls.stop()\n            }\n        },\n    }\n\n    return controls\n}\n"],"names":[],"mappings":"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"}
{"version":3,"file":"group.mjs","sources":["../../../../src/projection/node/group.ts"],"sourcesContent":["import { IProjectionNode } from \"./types\"\n\nconst notify = (node: IProjectionNode) =>\n    !node.isLayoutDirty && node.willUpdate(false)\n\nexport interface NodeGroup {\n    add: (node: IProjectionNode) => void\n    remove: (node: IProjectionNode) => void\n    dirty: VoidFunction\n}\n\nexport function nodeGroup(): NodeGroup {\n    const nodes = new Set<IProjectionNode>()\n    const subscriptions = new WeakMap<IProjectionNode, () => void>()\n\n    const dirtyAll = () => nodes.forEach(notify)\n\n    return {\n        add: (node) => {\n            nodes.add(node)\n            subscriptions.set(\n                node,\n                node.addEventListener(\"willUpdate\", dirtyAll)\n            )\n        },\n        remove: (node) => {\n            nodes.delete(node)\n            const unsubscribe = subscriptions.get(node)\n            if (unsubscribe) {\n                unsubscribe()\n                subscriptions.delete(node)\n            }\n            dirtyAll()\n        },\n        dirty: dirtyAll,\n    }\n}\n"],"names":[],"mappings":"AAEA,MAAM,MAAM,GAAG,CAAC,IAAqB,KACjC,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;SAQjC,SAAS,GAAA;AACrB,IAAA,MAAM,KAAK,GAAG,IAAI,GAAG,EAAmB,CAAA;AACxC,IAAA,MAAM,aAAa,GAAG,IAAI,OAAO,EAA+B,CAAA;IAEhE,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;IAE5C,OAAO;AACH,QAAA,GAAG,EAAE,CAAC,IAAI,KAAI;AACV,YAAA,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;AACf,YAAA,aAAa,CAAC,GAAG,CACb,IAAI,EACJ,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,QAAQ,CAAC,CAChD,CAAA;SACJ;AACD,QAAA,MAAM,EAAE,CAAC,IAAI,KAAI;AACb,YAAA,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;YAClB,MAAM,WAAW,GAAG,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;YAC3C,IAAI,WAAW,EAAE;AACb,gBAAA,WAAW,EAAE,CAAA;AACb,gBAAA,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;aAC7B;AACD,YAAA,QAAQ,EAAE,CAAA;SACb;AACD,QAAA,KAAK,EAAE,QAAQ;KAClB,CAAA;AACL;;;;"}